// jshint devel:true

// Setup data
var syndromesCases = [{"user_id":"USER-0","date_onset":"2015-06-01","date_reported":"2015-06-17","coords_reported":[27,8],"lat_reported":26,"lng_reported":6,"syndrome":"Diarreica","age":17,"gender":"Male"},{"user_id":"USER-1","date_onset":"2015-06-02","date_reported":"2015-06-06","coords_reported":[6,19],"lat_reported":4,"lng_reported":7,"syndrome":"Exantematica","age":20,"gender":"Male"},{"user_id":"USER-2","date_onset":"2015-06-20","date_reported":"2015-06-14","coords_reported":[12,0],"lat_reported":25,"lng_reported":2,"syndrome":"Diarreica","age":3,"gender":"Female"},{"user_id":"USER-3","date_onset":"2015-06-18","date_reported":"2015-06-06","coords_reported":[7,20],"lat_reported":15,"lng_reported":7,"syndrome":"Diarreica","age":2,"gender":"Female"},{"user_id":"USER-4","date_onset":"2015-06-04","date_reported":"2015-06-11","coords_reported":[29,22],"lat_reported":2,"lng_reported":17,"syndrome":"Diarreica","age":9,"gender":"Female"},{"user_id":"USER-5","date_onset":"2015-06-08","date_reported":"2015-06-20","coords_reported":[25,10],"lat_reported":12,"lng_reported":24,"syndrome":"Respiratoria","age":17,"gender":"Male"},{"user_id":"USER-6","date_onset":"2015-06-19","date_reported":"2015-06-01","coords_reported":[0,0],"lat_reported":0,"lng_reported":12,"syndrome":"Respiratoria","age":0,"gender":"Male"},{"user_id":"USER-7","date_onset":"2015-06-19","date_reported":"2015-06-06","coords_reported":[6,25],"lat_reported":22,"lng_reported":6,"syndrome":"Respiratoria","age":13,"gender":"Female"},{"user_id":"USER-8","date_onset":"2015-06-20","date_reported":"2015-06-04","coords_reported":[29,4],"lat_reported":28,"lng_reported":25,"syndrome":"Respiratoria","age":19,"gender":"Male"},{"user_id":"USER-9","date_onset":"2015-06-06","date_reported":"2015-06-07","coords_reported":[15,19],"lat_reported":0,"lng_reported":25,"syndrome":"Exantematica","age":4,"gender":"Male"},{"user_id":"USER-10","date_onset":"2015-06-18","date_reported":"2015-06-09","coords_reported":[16,23],"lat_reported":1,"lng_reported":12,"syndrome":"Respiratoria","age":22,"gender":"Male"},{"user_id":"USER-11","date_onset":"2015-06-12","date_reported":"2015-06-15","coords_reported":[26,6],"lat_reported":26,"lng_reported":16,"syndrome":"Exantematica","age":11,"gender":"Male"},{"user_id":"USER-12","date_onset":"2015-06-18","date_reported":"2015-06-20","coords_reported":[12,1],"lat_reported":3,"lng_reported":23,"syndrome":"Exantematica","age":17,"gender":"Male"},{"user_id":"USER-13","date_onset":"2015-06-19","date_reported":"2015-06-11","coords_reported":[9,19],"lat_reported":26,"lng_reported":27,"syndrome":"Exantematica","age":4,"gender":"Male"},{"user_id":"USER-14","date_onset":"2015-06-03","date_reported":"2015-06-03","coords_reported":[15,7],"lat_reported":22,"lng_reported":6,"syndrome":"Diarreica","age":26,"gender":"Female"},{"user_id":"USER-15","date_onset":"2015-06-15","date_reported":"2015-06-12","coords_reported":[13,4],"lat_reported":23,"lng_reported":22,"syndrome":"Respiratoria","age":26,"gender":"Female"},{"user_id":"USER-16","date_onset":"2015-06-15","date_reported":"2015-06-06","coords_reported":[0,22],"lat_reported":15,"lng_reported":6,"syndrome":"Exantematica","age":0,"gender":"Male"},{"user_id":"USER-17","date_onset":"2015-06-01","date_reported":"2015-06-09","coords_reported":[24,24],"lat_reported":19,"lng_reported":12,"syndrome":"Respiratoria","age":13,"gender":"Male"},{"user_id":"USER-18","date_onset":"2015-06-03","date_reported":"2015-06-11","coords_reported":[28,21],"lat_reported":12,"lng_reported":29,"syndrome":"Respiratoria","age":24,"gender":"Female"},{"user_id":"USER-19","date_onset":"2015-06-09","date_reported":"2015-06-02","coords_reported":[13,27],"lat_reported":24,"lng_reported":0,"syndrome":"Respiratoria","age":12,"gender":"Male"},{"user_id":"USER-20","date_onset":"2015-06-05","date_reported":"2015-06-08","coords_reported":[0,2],"lat_reported":2,"lng_reported":13,"syndrome":"Respiratoria","age":22,"gender":"Male"},{"user_id":"USER-21","date_onset":"2015-06-07","date_reported":"2015-06-13","coords_reported":[20,22],"lat_reported":9,"lng_reported":2,"syndrome":"Respiratoria","age":14,"gender":"Female"},{"user_id":"USER-22","date_onset":"2015-06-17","date_reported":"2015-06-08","coords_reported":[17,10],"lat_reported":23,"lng_reported":25,"syndrome":"Exantematica","age":15,"gender":"Female"},{"user_id":"USER-23","date_onset":"2015-06-19","date_reported":"2015-06-18","coords_reported":[19,19],"lat_reported":5,"lng_reported":24,"syndrome":"Diarreica","age":17,"gender":"Female"},{"user_id":"USER-24","date_onset":"2015-06-18","date_reported":"2015-06-10","coords_reported":[20,2],"lat_reported":22,"lng_reported":9,"syndrome":"Exantematica","age":27,"gender":"Male"},{"user_id":"USER-25","date_onset":"2015-06-18","date_reported":"2015-06-19","coords_reported":[18,5],"lat_reported":20,"lng_reported":2,"syndrome":"Diarreica","age":4,"gender":"Female"},{"user_id":"USER-26","date_onset":"2015-06-15","date_reported":"2015-06-15","coords_reported":[18,25],"lat_reported":25,"lng_reported":10,"syndrome":"Respiratoria","age":9,"gender":"Female"},{"user_id":"USER-27","date_onset":"2015-06-16","date_reported":"2015-06-09","coords_reported":[26,16],"lat_reported":28,"lng_reported":6,"syndrome":"Diarreica","age":17,"gender":"Female"},{"user_id":"USER-28","date_onset":"2015-06-12","date_reported":"2015-06-10","coords_reported":[21,9],"lat_reported":28,"lng_reported":0,"syndrome":"Diarreica","age":26,"gender":"Female"},{"user_id":"USER-29","date_onset":"2015-06-04","date_reported":"2015-06-19","coords_reported":[1,17],"lat_reported":18,"lng_reported":11,"syndrome":"Diarreica","age":16,"gender":"Female"},{"user_id":"USER-30","date_onset":"2015-06-04","date_reported":"2015-06-10","coords_reported":[17,4],"lat_reported":19,"lng_reported":23,"syndrome":"Exantematica","age":8,"gender":"Female"},{"user_id":"USER-31","date_onset":"2015-06-07","date_reported":"2015-06-14","coords_reported":[24,17],"lat_reported":5,"lng_reported":4,"syndrome":"Exantematica","age":4,"gender":"Female"},{"user_id":"USER-32","date_onset":"2015-06-01","date_reported":"2015-06-19","coords_reported":[14,27],"lat_reported":16,"lng_reported":22,"syndrome":"Diarreica","age":19,"gender":"Male"},{"user_id":"USER-33","date_onset":"2015-06-07","date_reported":"2015-06-13","coords_reported":[4,22],"lat_reported":4,"lng_reported":19,"syndrome":"Respiratoria","age":4,"gender":"Female"},{"user_id":"USER-34","date_onset":"2015-06-07","date_reported":"2015-06-19","coords_reported":[2,2],"lat_reported":9,"lng_reported":27,"syndrome":"Exantematica","age":13,"gender":"Male"},{"user_id":"USER-35","date_onset":"2015-06-04","date_reported":"2015-06-19","coords_reported":[11,29],"lat_reported":8,"lng_reported":20,"syndrome":"Diarreica","age":28,"gender":"Male"},{"user_id":"USER-36","date_onset":"2015-06-15","date_reported":"2015-06-07","coords_reported":[22,7],"lat_reported":28,"lng_reported":2,"syndrome":"Diarreica","age":4,"gender":"Male"},{"user_id":"USER-37","date_onset":"2015-06-19","date_reported":"2015-06-14","coords_reported":[25,21],"lat_reported":0,"lng_reported":7,"syndrome":"Diarreica","age":10,"gender":"Male"},{"user_id":"USER-38","date_onset":"2015-06-10","date_reported":"2015-06-09","coords_reported":[13,9],"lat_reported":15,"lng_reported":13,"syndrome":"Respiratoria","age":17,"gender":"Female"},{"user_id":"USER-39","date_onset":"2015-06-13","date_reported":"2015-06-11","coords_reported":[23,25],"lat_reported":15,"lng_reported":14,"syndrome":"Exantematica","age":25,"gender":"Male"},{"user_id":"USER-40","date_onset":"2015-06-17","date_reported":"2015-06-15","coords_reported":[18,6],"lat_reported":9,"lng_reported":23,"syndrome":"Respiratoria","age":14,"gender":"Female"},{"user_id":"USER-41","date_onset":"2015-06-19","date_reported":"2015-06-11","coords_reported":[25,18],"lat_reported":19,"lng_reported":27,"syndrome":"Diarreica","age":28,"gender":"Male"},{"user_id":"USER-42","date_onset":"2015-06-03","date_reported":"2015-06-18","coords_reported":[26,28],"lat_reported":20,"lng_reported":20,"syndrome":"Respiratoria","age":16,"gender":"Male"},{"user_id":"USER-43","date_onset":"2015-06-13","date_reported":"2015-06-16","coords_reported":[21,13],"lat_reported":5,"lng_reported":18,"syndrome":"Exantematica","age":25,"gender":"Female"},{"user_id":"USER-44","date_onset":"2015-06-07","date_reported":"2015-06-16","coords_reported":[29,20],"lat_reported":18,"lng_reported":4,"syndrome":"Diarreica","age":21,"gender":"Male"},{"user_id":"USER-45","date_onset":"2015-06-20","date_reported":"2015-06-11","coords_reported":[13,16],"lat_reported":11,"lng_reported":0,"syndrome":"Respiratoria","age":4,"gender":"Male"},{"user_id":"USER-46","date_onset":"2015-06-04","date_reported":"2015-06-08","coords_reported":[27,25],"lat_reported":7,"lng_reported":0,"syndrome":"Diarreica","age":4,"gender":"Male"},{"user_id":"USER-47","date_onset":"2015-06-04","date_reported":"2015-06-14","coords_reported":[10,10],"lat_reported":3,"lng_reported":8,"syndrome":"Respiratoria","age":1,"gender":"Male"},{"user_id":"USER-48","date_onset":"2015-06-15","date_reported":"2015-06-03","coords_reported":[13,18],"lat_reported":22,"lng_reported":16,"syndrome":"Respiratoria","age":15,"gender":"Female"},{"user_id":"USER-49","date_onset":"2015-06-19","date_reported":"2015-06-18","coords_reported":[18,1],"lat_reported":9,"lng_reported":2,"syndrome":"Diarreica","age":28,"gender":"Male"}];
var symptomsCases = [{"user_id":"USER-0","date_onset":"2015-06-04","date_reported":"2015-06-15","coords_reported":[2,29],"lat_reported":29,"lng_reported":3,"symptom":"rash","age":5,"gender":"Female"},{"user_id":"USER-1","date_onset":"2015-06-01","date_reported":"2015-06-06","coords_reported":[12,25],"lat_reported":6,"lng_reported":18,"symptom":"rash","age":15,"gender":"Male"},{"user_id":"USER-2","date_onset":"2015-06-14","date_reported":"2015-06-20","coords_reported":[12,25],"lat_reported":13,"lng_reported":9,"symptom":"headache","age":19,"gender":"Female"},{"user_id":"USER-3","date_onset":"2015-06-19","date_reported":"2015-06-07","coords_reported":[0,24],"lat_reported":29,"lng_reported":28,"symptom":"bleeding","age":28,"gender":"Male"},{"user_id":"USER-4","date_onset":"2015-06-11","date_reported":"2015-06-12","coords_reported":[28,23],"lat_reported":29,"lng_reported":1,"symptom":"fever","age":14,"gender":"Male"},{"user_id":"USER-5","date_onset":"2015-06-19","date_reported":"2015-06-14","coords_reported":[25,26],"lat_reported":23,"lng_reported":29,"symptom":"headache","age":19,"gender":"Male"},{"user_id":"USER-6","date_onset":"2015-06-04","date_reported":"2015-06-11","coords_reported":[23,16],"lat_reported":19,"lng_reported":1,"symptom":"cough","age":0,"gender":"Male"},{"user_id":"USER-7","date_onset":"2015-06-09","date_reported":"2015-06-14","coords_reported":[6,5],"lat_reported":16,"lng_reported":13,"symptom":"bleeding","age":4,"gender":"Male"},{"user_id":"USER-8","date_onset":"2015-06-16","date_reported":"2015-06-03","coords_reported":[1,22],"lat_reported":29,"lng_reported":17,"symptom":"bleeding","age":23,"gender":"Male"},{"user_id":"USER-9","date_onset":"2015-06-18","date_reported":"2015-06-04","coords_reported":[16,22],"lat_reported":29,"lng_reported":10,"symptom":"rash","age":16,"gender":"Female"},{"user_id":"USER-10","date_onset":"2015-06-19","date_reported":"2015-06-19","coords_reported":[3,13],"lat_reported":19,"lng_reported":16,"symptom":"bleeding","age":2,"gender":"Male"},{"user_id":"USER-11","date_onset":"2015-06-19","date_reported":"2015-06-19","coords_reported":[21,5],"lat_reported":0,"lng_reported":6,"symptom":"headache","age":21,"gender":"Male"},{"user_id":"USER-12","date_onset":"2015-06-16","date_reported":"2015-06-14","coords_reported":[4,14],"lat_reported":14,"lng_reported":23,"symptom":"cough","age":12,"gender":"Female"},{"user_id":"USER-13","date_onset":"2015-06-16","date_reported":"2015-06-08","coords_reported":[25,24],"lat_reported":18,"lng_reported":10,"symptom":"rash","age":20,"gender":"Female"},{"user_id":"USER-14","date_onset":"2015-06-01","date_reported":"2015-06-02","coords_reported":[5,7],"lat_reported":26,"lng_reported":22,"symptom":"cough","age":0,"gender":"Female"},{"user_id":"USER-15","date_onset":"2015-06-13","date_reported":"2015-06-03","coords_reported":[22,4],"lat_reported":8,"lng_reported":19,"symptom":"fever","age":29,"gender":"Female"},{"user_id":"USER-16","date_onset":"2015-06-15","date_reported":"2015-06-10","coords_reported":[21,9],"lat_reported":2,"lng_reported":7,"symptom":"cough","age":17,"gender":"Female"},{"user_id":"USER-17","date_onset":"2015-06-09","date_reported":"2015-06-15","coords_reported":[1,13],"lat_reported":18,"lng_reported":0,"symptom":"bleeding","age":26,"gender":"Female"},{"user_id":"USER-18","date_onset":"2015-06-03","date_reported":"2015-06-07","coords_reported":[3,26],"lat_reported":27,"lng_reported":18,"symptom":"rash","age":16,"gender":"Male"},{"user_id":"USER-19","date_onset":"2015-06-18","date_reported":"2015-06-05","coords_reported":[22,13],"lat_reported":4,"lng_reported":10,"symptom":"cough","age":17,"gender":"Female"},{"user_id":"USER-20","date_onset":"2015-06-19","date_reported":"2015-06-14","coords_reported":[21,1],"lat_reported":29,"lng_reported":20,"symptom":"fever","age":13,"gender":"Male"},{"user_id":"USER-21","date_onset":"2015-06-06","date_reported":"2015-06-19","coords_reported":[3,20],"lat_reported":19,"lng_reported":2,"symptom":"bleeding","age":24,"gender":"Male"},{"user_id":"USER-22","date_onset":"2015-06-16","date_reported":"2015-06-17","coords_reported":[6,14],"lat_reported":10,"lng_reported":22,"symptom":"bleeding","age":10,"gender":"Male"},{"user_id":"USER-23","date_onset":"2015-06-16","date_reported":"2015-06-08","coords_reported":[11,0],"lat_reported":3,"lng_reported":5,"symptom":"rash","age":11,"gender":"Female"},{"user_id":"USER-24","date_onset":"2015-06-02","date_reported":"2015-06-18","coords_reported":[28,9],"lat_reported":4,"lng_reported":11,"symptom":"cough","age":12,"gender":"Male"},{"user_id":"USER-25","date_onset":"2015-06-01","date_reported":"2015-06-04","coords_reported":[25,7],"lat_reported":25,"lng_reported":1,"symptom":"cough","age":19,"gender":"Male"},{"user_id":"USER-26","date_onset":"2015-06-17","date_reported":"2015-06-10","coords_reported":[19,13],"lat_reported":19,"lng_reported":14,"symptom":"headache","age":0,"gender":"Female"},{"user_id":"USER-27","date_onset":"2015-06-01","date_reported":"2015-06-09","coords_reported":[24,0],"lat_reported":24,"lng_reported":21,"symptom":"headache","age":23,"gender":"Male"},{"user_id":"USER-28","date_onset":"2015-06-11","date_reported":"2015-06-06","coords_reported":[12,1],"lat_reported":25,"lng_reported":28,"symptom":"bleeding","age":10,"gender":"Male"},{"user_id":"USER-29","date_onset":"2015-06-15","date_reported":"2015-06-01","coords_reported":[22,12],"lat_reported":7,"lng_reported":0,"symptom":"rash","age":20,"gender":"Female"},{"user_id":"USER-30","date_onset":"2015-06-13","date_reported":"2015-06-05","coords_reported":[7,15],"lat_reported":0,"lng_reported":24,"symptom":"fever","age":16,"gender":"Female"},{"user_id":"USER-31","date_onset":"2015-06-07","date_reported":"2015-06-06","coords_reported":[15,7],"lat_reported":4,"lng_reported":29,"symptom":"fever","age":18,"gender":"Female"},{"user_id":"USER-32","date_onset":"2015-06-02","date_reported":"2015-06-05","coords_reported":[14,21],"lat_reported":26,"lng_reported":19,"symptom":"cough","age":15,"gender":"Female"},{"user_id":"USER-33","date_onset":"2015-06-01","date_reported":"2015-06-02","coords_reported":[10,23],"lat_reported":28,"lng_reported":11,"symptom":"headache","age":22,"gender":"Male"},{"user_id":"USER-34","date_onset":"2015-06-08","date_reported":"2015-06-16","coords_reported":[20,2],"lat_reported":0,"lng_reported":3,"symptom":"headache","age":9,"gender":"Female"},{"user_id":"USER-35","date_onset":"2015-06-18","date_reported":"2015-06-18","coords_reported":[27,13],"lat_reported":0,"lng_reported":7,"symptom":"cough","age":17,"gender":"Female"},{"user_id":"USER-36","date_onset":"2015-06-15","date_reported":"2015-06-13","coords_reported":[24,1],"lat_reported":8,"lng_reported":2,"symptom":"rash","age":17,"gender":"Male"},{"user_id":"USER-37","date_onset":"2015-06-17","date_reported":"2015-06-12","coords_reported":[10,26],"lat_reported":4,"lng_reported":25,"symptom":"headache","age":7,"gender":"Male"},{"user_id":"USER-38","date_onset":"2015-06-20","date_reported":"2015-06-10","coords_reported":[17,28],"lat_reported":15,"lng_reported":22,"symptom":"headache","age":28,"gender":"Male"},{"user_id":"USER-39","date_onset":"2015-06-13","date_reported":"2015-06-11","coords_reported":[22,7],"lat_reported":12,"lng_reported":23,"symptom":"cough","age":23,"gender":"Male"},{"user_id":"USER-40","date_onset":"2015-06-13","date_reported":"2015-06-06","coords_reported":[3,5],"lat_reported":22,"lng_reported":10,"symptom":"headache","age":27,"gender":"Female"},{"user_id":"USER-41","date_onset":"2015-06-07","date_reported":"2015-06-07","coords_reported":[18,25],"lat_reported":18,"lng_reported":17,"symptom":"bleeding","age":7,"gender":"Female"},{"user_id":"USER-42","date_onset":"2015-06-04","date_reported":"2015-06-11","coords_reported":[20,3],"lat_reported":0,"lng_reported":0,"symptom":"headache","age":19,"gender":"Female"},{"user_id":"USER-43","date_onset":"2015-06-13","date_reported":"2015-06-16","coords_reported":[0,12],"lat_reported":14,"lng_reported":7,"symptom":"bleeding","age":11,"gender":"Female"},{"user_id":"USER-44","date_onset":"2015-06-17","date_reported":"2015-06-06","coords_reported":[18,14],"lat_reported":14,"lng_reported":24,"symptom":"headache","age":20,"gender":"Male"},{"user_id":"USER-45","date_onset":"2015-06-05","date_reported":"2015-06-01","coords_reported":[7,25],"lat_reported":28,"lng_reported":9,"symptom":"bleeding","age":27,"gender":"Male"},{"user_id":"USER-46","date_onset":"2015-06-13","date_reported":"2015-06-13","coords_reported":[4,16],"lat_reported":23,"lng_reported":13,"symptom":"bleeding","age":20,"gender":"Male"},{"user_id":"USER-47","date_onset":"2015-06-12","date_reported":"2015-06-04","coords_reported":[6,11],"lat_reported":14,"lng_reported":17,"symptom":"fever","age":19,"gender":"Male"},{"user_id":"USER-48","date_onset":"2015-06-07","date_reported":"2015-06-06","coords_reported":[4,9],"lat_reported":5,"lng_reported":27,"symptom":"fever","age":23,"gender":"Male"},{"user_id":"USER-49","date_onset":"2015-06-19","date_reported":"2015-06-15","coords_reported":[20,11],"lat_reported":17,"lng_reported":3,"symptom":"rash","age":8,"gender":"Male"},{"user_id":"USER-50","date_onset":"2015-06-17","date_reported":"2015-06-06","coords_reported":[18,16],"lat_reported":29,"lng_reported":11,"symptom":"cough","age":11,"gender":"Female"},{"user_id":"USER-51","date_onset":"2015-06-01","date_reported":"2015-06-17","coords_reported":[10,26],"lat_reported":8,"lng_reported":10,"symptom":"rash","age":6,"gender":"Male"},{"user_id":"USER-52","date_onset":"2015-06-13","date_reported":"2015-06-13","coords_reported":[6,5],"lat_reported":15,"lng_reported":5,"symptom":"fever","age":14,"gender":"Male"},{"user_id":"USER-53","date_onset":"2015-06-14","date_reported":"2015-06-15","coords_reported":[0,3],"lat_reported":29,"lng_reported":1,"symptom":"bleeding","age":21,"gender":"Female"},{"user_id":"USER-54","date_onset":"2015-06-18","date_reported":"2015-06-01","coords_reported":[6,28],"lat_reported":21,"lng_reported":29,"symptom":"fever","age":2,"gender":"Female"},{"user_id":"USER-55","date_onset":"2015-06-02","date_reported":"2015-06-06","coords_reported":[26,9],"lat_reported":20,"lng_reported":6,"symptom":"cough","age":15,"gender":"Female"},{"user_id":"USER-56","date_onset":"2015-06-16","date_reported":"2015-06-12","coords_reported":[8,14],"lat_reported":23,"lng_reported":9,"symptom":"headache","age":10,"gender":"Male"},{"user_id":"USER-57","date_onset":"2015-06-06","date_reported":"2015-06-09","coords_reported":[9,28],"lat_reported":26,"lng_reported":28,"symptom":"headache","age":28,"gender":"Female"},{"user_id":"USER-58","date_onset":"2015-06-14","date_reported":"2015-06-17","coords_reported":[21,8],"lat_reported":19,"lng_reported":0,"symptom":"cough","age":13,"gender":"Male"},{"user_id":"USER-59","date_onset":"2015-06-04","date_reported":"2015-06-06","coords_reported":[13,2],"lat_reported":28,"lng_reported":6,"symptom":"rash","age":4,"gender":"Male"},{"user_id":"USER-60","date_onset":"2015-06-14","date_reported":"2015-06-08","coords_reported":[4,18],"lat_reported":16,"lng_reported":18,"symptom":"headache","age":6,"gender":"Male"},{"user_id":"USER-61","date_onset":"2015-06-14","date_reported":"2015-06-11","coords_reported":[18,12],"lat_reported":1,"lng_reported":24,"symptom":"rash","age":20,"gender":"Male"},{"user_id":"USER-62","date_onset":"2015-06-01","date_reported":"2015-06-15","coords_reported":[24,1],"lat_reported":2,"lng_reported":21,"symptom":"cough","age":6,"gender":"Male"},{"user_id":"USER-63","date_onset":"2015-06-11","date_reported":"2015-06-19","coords_reported":[13,21],"lat_reported":8,"lng_reported":8,"symptom":"cough","age":6,"gender":"Male"},{"user_id":"USER-64","date_onset":"2015-06-17","date_reported":"2015-06-12","coords_reported":[0,1],"lat_reported":5,"lng_reported":29,"symptom":"cough","age":2,"gender":"Female"},{"user_id":"USER-65","date_onset":"2015-06-03","date_reported":"2015-06-09","coords_reported":[21,18],"lat_reported":11,"lng_reported":4,"symptom":"cough","age":24,"gender":"Male"},{"user_id":"USER-66","date_onset":"2015-06-15","date_reported":"2015-06-13","coords_reported":[0,13],"lat_reported":13,"lng_reported":28,"symptom":"cough","age":22,"gender":"Male"},{"user_id":"USER-67","date_onset":"2015-06-04","date_reported":"2015-06-02","coords_reported":[16,0],"lat_reported":1,"lng_reported":14,"symptom":"headache","age":28,"gender":"Female"},{"user_id":"USER-68","date_onset":"2015-06-18","date_reported":"2015-06-06","coords_reported":[27,8],"lat_reported":5,"lng_reported":5,"symptom":"headache","age":9,"gender":"Male"},{"user_id":"USER-69","date_onset":"2015-06-19","date_reported":"2015-06-08","coords_reported":[19,3],"lat_reported":29,"lng_reported":19,"symptom":"bleeding","age":13,"gender":"Male"},{"user_id":"USER-70","date_onset":"2015-06-14","date_reported":"2015-06-03","coords_reported":[21,1],"lat_reported":1,"lng_reported":5,"symptom":"fever","age":12,"gender":"Female"},{"user_id":"USER-71","date_onset":"2015-06-13","date_reported":"2015-06-11","coords_reported":[0,16],"lat_reported":18,"lng_reported":2,"symptom":"headache","age":24,"gender":"Female"},{"user_id":"USER-72","date_onset":"2015-06-07","date_reported":"2015-06-16","coords_reported":[19,25],"lat_reported":16,"lng_reported":8,"symptom":"bleeding","age":28,"gender":"Male"},{"user_id":"USER-73","date_onset":"2015-06-13","date_reported":"2015-06-12","coords_reported":[18,26],"lat_reported":1,"lng_reported":23,"symptom":"cough","age":7,"gender":"Male"},{"user_id":"USER-74","date_onset":"2015-06-01","date_reported":"2015-06-11","coords_reported":[19,16],"lat_reported":13,"lng_reported":20,"symptom":"fever","age":2,"gender":"Male"},{"user_id":"USER-75","date_onset":"2015-06-13","date_reported":"2015-06-05","coords_reported":[20,18],"lat_reported":22,"lng_reported":5,"symptom":"cough","age":18,"gender":"Male"},{"user_id":"USER-76","date_onset":"2015-06-13","date_reported":"2015-06-18","coords_reported":[1,24],"lat_reported":11,"lng_reported":10,"symptom":"bleeding","age":19,"gender":"Male"},{"user_id":"USER-77","date_onset":"2015-06-17","date_reported":"2015-06-12","coords_reported":[0,5],"lat_reported":6,"lng_reported":6,"symptom":"cough","age":20,"gender":"Male"},{"user_id":"USER-78","date_onset":"2015-06-10","date_reported":"2015-06-11","coords_reported":[10,6],"lat_reported":22,"lng_reported":5,"symptom":"rash","age":6,"gender":"Male"},{"user_id":"USER-79","date_onset":"2015-06-03","date_reported":"2015-06-15","coords_reported":[1,6],"lat_reported":20,"lng_reported":10,"symptom":"fever","age":27,"gender":"Female"},{"user_id":"USER-80","date_onset":"2015-06-19","date_reported":"2015-06-10","coords_reported":[10,11],"lat_reported":15,"lng_reported":14,"symptom":"fever","age":6,"gender":"Male"},{"user_id":"USER-81","date_onset":"2015-06-20","date_reported":"2015-06-11","coords_reported":[15,10],"lat_reported":9,"lng_reported":0,"symptom":"rash","age":18,"gender":"Female"},{"user_id":"USER-82","date_onset":"2015-06-19","date_reported":"2015-06-06","coords_reported":[8,23],"lat_reported":15,"lng_reported":24,"symptom":"rash","age":21,"gender":"Male"},{"user_id":"USER-83","date_onset":"2015-06-12","date_reported":"2015-06-12","coords_reported":[22,3],"lat_reported":20,"lng_reported":22,"symptom":"headache","age":2,"gender":"Male"},{"user_id":"USER-84","date_onset":"2015-06-03","date_reported":"2015-06-07","coords_reported":[26,10],"lat_reported":17,"lng_reported":1,"symptom":"rash","age":20,"gender":"Male"},{"user_id":"USER-85","date_onset":"2015-06-04","date_reported":"2015-06-08","coords_reported":[27,21],"lat_reported":12,"lng_reported":20,"symptom":"cough","age":2,"gender":"Female"},{"user_id":"USER-86","date_onset":"2015-06-16","date_reported":"2015-06-03","coords_reported":[18,3],"lat_reported":17,"lng_reported":24,"symptom":"rash","age":21,"gender":"Male"},{"user_id":"USER-87","date_onset":"2015-06-06","date_reported":"2015-06-14","coords_reported":[27,8],"lat_reported":27,"lng_reported":9,"symptom":"cough","age":4,"gender":"Female"},{"user_id":"USER-88","date_onset":"2015-06-20","date_reported":"2015-06-01","coords_reported":[20,24],"lat_reported":21,"lng_reported":18,"symptom":"bleeding","age":9,"gender":"Female"},{"user_id":"USER-89","date_onset":"2015-06-03","date_reported":"2015-06-19","coords_reported":[6,16],"lat_reported":19,"lng_reported":5,"symptom":"fever","age":22,"gender":"Male"},{"user_id":"USER-90","date_onset":"2015-06-12","date_reported":"2015-06-06","coords_reported":[1,6],"lat_reported":16,"lng_reported":13,"symptom":"cough","age":27,"gender":"Female"},{"user_id":"USER-91","date_onset":"2015-06-10","date_reported":"2015-06-20","coords_reported":[5,17],"lat_reported":23,"lng_reported":11,"symptom":"fever","age":6,"gender":"Male"},{"user_id":"USER-92","date_onset":"2015-06-09","date_reported":"2015-06-02","coords_reported":[3,10],"lat_reported":22,"lng_reported":16,"symptom":"bleeding","age":25,"gender":"Male"},{"user_id":"USER-93","date_onset":"2015-06-14","date_reported":"2015-06-07","coords_reported":[18,18],"lat_reported":4,"lng_reported":29,"symptom":"fever","age":27,"gender":"Male"},{"user_id":"USER-94","date_onset":"2015-06-06","date_reported":"2015-06-17","coords_reported":[23,16],"lat_reported":19,"lng_reported":4,"symptom":"rash","age":14,"gender":"Female"},{"user_id":"USER-95","date_onset":"2015-06-01","date_reported":"2015-06-02","coords_reported":[28,8],"lat_reported":21,"lng_reported":16,"symptom":"rash","age":2,"gender":"Male"},{"user_id":"USER-96","date_onset":"2015-06-08","date_reported":"2015-06-07","coords_reported":[25,7],"lat_reported":12,"lng_reported":16,"symptom":"rash","age":5,"gender":"Female"},{"user_id":"USER-97","date_onset":"2015-06-04","date_reported":"2015-06-09","coords_reported":[1,29],"lat_reported":3,"lng_reported":29,"symptom":"bleeding","age":25,"gender":"Male"},{"user_id":"USER-98","date_onset":"2015-06-09","date_reported":"2015-06-16","coords_reported":[23,15],"lat_reported":13,"lng_reported":12,"symptom":"fever","age":24,"gender":"Male"},{"user_id":"USER-99","date_onset":"2015-06-03","date_reported":"2015-06-17","coords_reported":[18,26],"lat_reported":13,"lng_reported":21,"symptom":"headache","age":10,"gender":"Male"}];

// Initialise dataset

var symptomsDataset = crossfilter(symptomsCases);
var allSymptoms = symptomsDataset.groupAll();


// Symptoms row chart
var symptomsChart = dc.rowChart('#symptomsChart');

var symptomsDimension = symptomsDataset.dimension(function (d) { return d.symptom; });
var symptomsGroup = symptomsDimension.group();


symptomsChart.width(640)
  .height(480)
  .margins({top: 20, left: 10, right: 10, bottom: 20})
  .group(symptomsGroup)
  .dimension(symptomsDimension)
  .label(function (d) {
    return d.key;
  })
  .title(function (d) {
    return d.value
  })
  .elasticX(true);


// Data count widget

var countChart = dc.dataCount('#dataCount').dimension(symptomsDataset).group(allSymptoms);

// Time series chart

var timeChart = dc.lineChart("#timeSeries");
var navChart = dc.barChart("#timeNavigation");

var volumeByHour = symptomsDataset.dimension(function(d) {
  return new Date(d.date_onset);
});

var volumeByHourGroup = volumeByHour.group(
  function(the_date){
    return d3.time.day(the_date); // TODO make the granularity easier to see 
  }
);

//For some very strange reason reduceCount is not working - it is simply never
//called when group().reduceCount() is run on a set - 
// - could this be because we are using a bleeding edge version of dc.js?
//So instead we just do some hacking - using reduceSum as a reduceCount alternative

var symptomGroupsTimeSeries = 
  volumeByHour
  .group(function(date){
      return d3.time.day(date); // TODO make the granularity easier to see 
  })
  .reduce(
    function(p, d){
      p[d.symptom] = (p[d.symptom] || 0) + 1;
      return p;  
    },
    function(p, d) {
      --p[d.symptom];
      return p;
    },
    function() { return {}; }
  );

//inspired by this hack, which was actually wrongly implemented?
//http://stackoverflow.com/questions/24415665/dc-js-stacked-area-chart-using-reducecount-method

//This extracts all the symptoms we have seen!
//We have to extract the first element here because we can't modify the array 
// as everything here is lazy and computed asynchronously!
console.log(symptomsGroup.top(Infinity));
var observed_symptoms = symptomsGroup.top(Infinity).map(function(obj){ return obj.key; });
var first_symptom = observed_symptoms[0];
observed_symptoms.shift();

timeChart
  .width(800)
  .height(200)
  .renderArea(true)
  .margins({top: 10, right: 10, bottom: 20, left: 40})
  .dimension(volumeByHour)
  .group(symptomGroupsTimeSeries, first_symptom, function(d){
    return d.value[first_symptom] || 0;
  })
  .brushOn(false) // we need this for the clickable hack haha

observed_symptoms.forEach(function(field, i){
  timeChart.stack(symptomGroupsTimeSeries, observed_symptoms[i], function(d){
    return d.value[field] || 0;
  });
});

timeChart
  .rangeChart(navChart)
  .transitionDuration(500)
  .elasticY(true)
  .x(d3.time.scale().domain([new Date(2015, 5, 1), new Date(2015, 6, 1)]))
  .xUnits(d3.time.days)
  .xAxis()

//This hack is terrible but dives into d3 to find the area entities in the 
//svg and makes them clickable.
timeChart.on('renderlet.timechart', function(chart, filter) {
    chart.selectAll("path.area").on("click.timechart", (
      function(d) {
        symptomsChart.filter([d.name]);
        dc.redrawAll();
      }
    ));
  });

//onclick issue maybe fixed here https://github.com/dc-js/dc.js/issues/168

navChart.width(800)
  .height(40)
  .margins({top: 0, right: 50, bottom: 20, left: 40})
  .dimension(volumeByHour)
  .group(volumeByHourGroup)
  .centerBar(true)
  .gap(1)
  //.elasticX(true)
  .x(d3.time.scale().domain([new Date(2015, 5, 1), new Date(2015, 6, 1)]))
  .round(d3.time.days.round)
  .alwaysUseRounding(true)
  .xUnits(d3.time.days);

dc.renderAll();
